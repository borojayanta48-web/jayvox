<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JayVox</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: black;
  color: white;
}

header {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 15px;
  background: linear-gradient(90deg,#000,#8b0000);
  box-shadow: 0 0 15px red;
}

header img {
  width: 60px;
  border-radius: 10px;
}

header h1 {
  margin: 0;
  font-size: 28px;
}

.search-box {
  padding: 15px;
}

.search-box input {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: none;
  font-size: 16px;
}

.section-title {
  color: #ff5c5c;
  padding: 10px 15px;
  font-size: 22px;
  font-weight: bold;
}

.song-card {
  display: flex;
  align-items: center;
  gap: 15px;
  margin: 10px 15px;
  padding: 12px;
  border-radius: 14px;
  background: #111;
  box-shadow: 0 0 10px rgba(255,0,0,0.3);
}

.song-card img {
  width: 70px;
  height: 70px;
  border-radius: 12px;
}

.song-info {
  flex: 1;
}

.song-info h3 {
  margin: 0;
}

audio {
  width: 100%;
  margin-top: 8px;
}

.play-count {
  font-size: 13px;
  color: #aaa;
}
</style>
</head>

<body>

<header>
  <img src="images/logo.jpg">
  <h1>JayVox</h1>
</header>

<div class="search-box">
  <input type="text" id="search" placeholder="Search songs...">
</div>

<div id="songs"></div>

<script>
let songsData = [];

fetch('songs.json')
.then(res => res.json())
.then(data => {
  songsData = data;
  displaySongs(data);
});

function displaySongs(data) {
  const container = document.getElementById("songs");
  container.innerHTML = "";

  const categories = {};

  data.forEach(song => {
    if (!categories[song.category]) {
      categories[song.category] = [];
    }
    categories[song.category].push(song);
  });

  for (let cat in categories) {
    container.innerHTML += `<div class="section-title">${cat}</div>`;

    categories[cat].forEach(song => {
      const id = song.file.replace(".mp3","");
      container.innerHTML += `
      <div class="song-card">
        <img src="images/${song.image}">
        <div class="song-info">
          <h3>${song.title}</h3>
          <audio controls onplay="countPlay('${id}')">
            <source src="songs/${song.file}" type="audio/mpeg">
          </audio>
          <div class="play-count" id="count-${id}">Played 0 times</div>
        </div>
      </div>`;
      loadCount(id);
    });
  }
}

document.getElementById("search").addEventListener("input", function() {
  const text = this.value.toLowerCase();
  const filtered = songsData.filter(s =>
    s.title.toLowerCase().includes(text)
  );
  displaySongs(filtered);
});
</script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyACzipenb7Sx0-XsNF8xiNCEE8uIeOsXuU",
  authDomain: "jayvox-be536.firebaseapp.com",
  databaseURL: "https://jayvox-be536-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "jayvox-be536",
  storageBucket: "jayvox-be536.firebasestorage.app",
  messagingSenderId: "427814511964",
  appId: "1:427814511964:web:e8a16e2e2275ef1d160d99"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function countPlay(id) {
  const ref = db.ref("plays/" + id);
  ref.once("value").then(snap => {
    let val = snap.val() || 0;
    ref.set(val + 1);
  });
}

function loadCount(id) {
  const ref = db.ref("plays/" + id);
  ref.on("value", snap => {
    const val = snap.val() || 0;
    document.getElementById("count-" + id).innerText =
      "Played " + val + " times";
  });
}
</script>

</body>
</html>
