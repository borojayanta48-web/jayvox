<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>JayVox</title>

<style>
body{
background:#000;
color:#fff;
font-family:Arial;
margin:0;
}

header{
background:linear-gradient(90deg,#000,#8b0000);
padding:20px;
display:flex;
align-items:center;
gap:15px;
box-shadow:0 0 20px red;
}

header img{
width:60px;
border-radius:12px;
}

header h1{
margin:0;
font-size:28px;
}

#search{
width:90%;
margin:20px auto;
display:block;
padding:12px;
border-radius:12px;
border:none;
font-size:16px;
}

.category{
padding:10px 20px;
color:#ff6b6b;
font-size:22px;
font-weight:bold;
}

.song{
background:#111;
margin:15px;
padding:15px;
border-radius:18px;
box-shadow:0 0 15px rgba(255,0,0,0.2);
display:flex;
gap:15px;
align-items:center;
}

.song img{
width:70px;
height:70px;
border-radius:12px;
}

.song-info{
flex:1;
}

audio{
width:100%;
margin-top:5px;
}

.playcount{
font-size:13px;
color:#aaa;
margin-top:5px;
}

.fav{
font-size:20px;
cursor:pointer;
}
</style>
</head>
<body>

<header>
<img src="images/logo.jpg">
<h1>JayVox</h1>
</header>

<input id="search" placeholder="Search songs...">

<div id="songs"></div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
const firebaseConfig = {
apiKey: "AIzaSyACzipenb7Sx0-XsNF8xiNCEE8uIeOsXuU",
authDomain: "jayvox-be536.firebaseapp.com",
databaseURL: "https://jayvox-be536-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId: "jayvox-be536",
storageBucket: "jayvox-be536.firebasestorage.app",
messagingSenderId: "427814511964",
appId: "1:427814511964:web:e8a16e2e2275ef1d160d99"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

fetch("songs.json")
.then(r=>r.json())
.then(data=>build(data));

function build(songs){
const container=document.getElementById("songs");

let grouped={};

songs.forEach(s=>{
if(!grouped[s.category]) grouped[s.category]=[];
grouped[s.category].push(s);
});

for(let cat in grouped){
let title=document.createElement("div");
title.className="category";
title.innerText=cat;
container.appendChild(title);

grouped[cat].forEach(song=>{
let div=document.createElement("div");
div.className="song";
div.setAttribute("data-title",song.title.toLowerCase());

div.innerHTML=`
<img src="${song.image}">
<div class="song-info">
<b>${song.title}</b><br>
Category: ${song.category}
<audio controls src="${song.file}"></audio>
<div class="playcount" id="count-${song.id}">Played 0 times</div>
</div>
<div class="fav" onclick="toggleFav(this)">♡</div>
`;

container.appendChild(div);

let audio=div.querySelector("audio");
let played=false;

audio.addEventListener("play",()=>{
if(!played){
played=true;
let ref=db.ref("plays/"+song.id);
ref.transaction(v=>(v||0)+1);
}
});

db.ref("plays/"+song.id).on("value",snap=>{
let val=snap.val()||0;
document.getElementById("count-"+song.id).innerText=
"Played "+val+" times";
});
});
}
}

document.getElementById("search").oninput=function(){
let q=this.value.toLowerCase();
document.querySelectorAll(".song").forEach(s=>{
s.style.display=s.dataset.title.includes(q)?"flex":"none";
});
};

function toggleFav(el){
el.innerText = el.innerText=="♡" ? "❤️" : "♡";
}
</script>

</body>
</html>
